name: Auto Movie Database Crawler

on:
  schedule:
    - cron: "0 */6 * * *"    # chạy mỗi 6 tiếng
    - cron: "0 5 * * *"      # chạy thêm 12h trưa giờ VN (5h UTC)
  workflow_dispatch:          # cho phép chạy thủ công

jobs:
  run-crawler:
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Checkout repository
        uses: actions/checkout@v4

      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: 📦 Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests textblob pyodbc beautifulsoup4 lxml
          python -m textblob.download_corpora

      - name: ⚙️ Run crawler script
        env:
          TMDB_KEY: ${{ secrets.TMDB_KEY }}
          OMDB_KEY: ${{ secrets.OMDB_KEY }}
          DB_SERVER: ${{ secrets.DB_SERVER }}
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASS: ${{ secrets.DB_PASS }}
        run: |
          echo "🕒 UTC Time: $(date -u)"
          echo "🇻🇳 Vietnam Time: $(TZ='Asia/Ho_Chi_Minh' date)"
          python DATABASE.py